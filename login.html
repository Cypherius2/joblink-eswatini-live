<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In | JobLinkEswatini</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="auth-body">
    <div id="notification-container"></div>
    <div class="auth-container">
        <div class="auth-header">
            <a href="index.html" class="logo-link">
                <h1 class="logo">JobLink<span class="logo-eswatini">Eswatini</span></h1>
            </a>
            <h2>Welcome Back</h2>
        </div>

        <!-- The form itself no longer has a submit button inside it -->
        <form class="auth-form" id="loginForm">
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password" required>
            </div>
            <!-- The submit button has been moved outside the form -->
        </form>

        <!-- This is a standard button now, not a submit button -->
        <button class="auth-button" id="loginButton">Sign In</button>

        <div class="auth-footer">
            <p>New to JobLinkEswatini? <a href="signup.html">Join now</a></p>
        </div>
    </div>
    <script src="js/config.js"></script>
    <script>

        document.getElementById('loginButton').addEventListener('click', async () => {
            console.log('--- BROWSER SCRIPT ---');
            console.log('[BROWSER LOG 1] Sign In button clicked.');

            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');

            const loginData = {
                email: emailInput.value,
                password: passwordInput.value
            };

            try {
                console.log('[BROWSER LOG 2] Sending request to server...');
                const response = await fetch(`${API_URL}/api/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(loginData)
                });

                console.log(`[BROWSER LOG 3] Received response from server with status: ${response.status}`);
                const result = await response.json();
                console.log('[BROWSER LOG 4] Response body parsed:', result);

                if (response.ok) {
                    console.log('[BROWSER LOG 5a] Response is OK. Storing token...');
                    localStorage.setItem('token', result.token);
                    console.log('[BROWSER LOG 5b] Token stored. Redirecting now...');

                    // --- THE REDIRECT ---
                    window.location.href = 'profile.html';

                } else {
                    console.error('[BROWSER LOG 6] Server returned an error:', result.msg);
                    alert('Error: ' + result.msg);
                }
            } catch (error) {
                console.error('[BROWSER LOG 7] A fatal error occurred in the fetch process:', error);
                alert('A critical error occurred. Check the console.');
            }
        });

    </script>
</body>

</html>